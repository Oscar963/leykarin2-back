# ========================================
# CONFIGURACIÓN DE PRODUCCIÓN - LEYKARIN2
# ========================================
# Este archivo contiene la configuración SEGURA para producción
# NUNCA commitear el archivo .env real con valores sensibles

APP_NAME="Leykarin"
APP_ENV=production
APP_KEY=   # <--- Generar con: php artisan key:generate
APP_DEBUG=false   # ⚠️ SIEMPRE false en producción
APP_URL=https://leykarin2.imaarica.cl

LOG_CHANNEL=stack
LOG_DEPRECATIONS_CHANNEL=null
LOG_LEVEL=error   # Solo errores en producción

# ========================================
# BASE DE DATOS - PRODUCCIÓN
# ========================================
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=leykarin_prod
DB_USERNAME=leykarin_user
DB_PASSWORD=   # <--- Contraseña segura (min 32 caracteres)

DB_CHARSET=utf8mb4
DB_COLLATION=utf8mb4_unicode_ci

# ========================================
# CACHE Y SESIONES - REDIS (RECOMENDADO)
# ========================================
BROADCAST_DRIVER=redis
CACHE_DRIVER=redis
FILESYSTEM_DISK=local
QUEUE_CONNECTION=redis
SESSION_DRIVER=redis   # ⚠️ CRÍTICO: Usar Redis en producción
SESSION_LIFETIME=480   # 8 horas laborales

# Redis Configuration
REDIS_HOST=127.0.0.1
REDIS_PASSWORD=   # <--- Contraseña de Redis
REDIS_PORT=6379
REDIS_CLIENT=phpredis   # Más rápido que predis

# ========================================
# CONFIGURACIÓN DE SEGURIDAD - COOKIES
# ========================================
# ⚠️ CRÍTICO: Estas configuraciones son OBLIGATORIAS para producción

SESSION_SECURE_COOKIE=true   # ⚠️ OBLIGATORIO - Solo HTTPS
SESSION_SAME_SITE=none   # ⚠️ OBLIGATORIO si frontend está en dominio diferente
SESSION_DOMAIN=.imaarica.cl   # Dominio compartido para cookies
SESSION_ENCRYPT=true   # Encriptar datos de sesión

# Timeout de inactividad (30 minutos = 1800 segundos)
SESSION_INACTIVITY_TIMEOUT=1800

# Sesiones concurrentes
SESSION_MAX_CONCURRENT=3   # Máximo 3 sesiones por usuario
SESSION_CONCURRENT_STRATEGY=notify   # notify|block|logout_oldest

# ========================================
# SANCTUM - AUTENTICACIÓN
# ========================================
SANCTUM_STATEFUL_DOMAINS=leykarin2.imaarica.cl,admin.imaarica.cl,*.imaarica.cl

# ========================================
# CORS - CONFIGURACIÓN SEGURA
# ========================================
CORS_ALLOWED_ORIGINS=https://leykarin2.imaarica.cl,https://admin.imaarica.cl

# ========================================
# MAIL - PRODUCCIÓN
# ========================================
MAIL_MAILER=smtp
MAIL_HOST=smtp.gmail.com   # O tu servidor SMTP
MAIL_PORT=587
MAIL_USERNAME=   # <--- Email de envío
MAIL_PASSWORD=   # <--- Contraseña de aplicación
MAIL_ENCRYPTION=tls
MAIL_FROM_ADDRESS="noreply@imaarica.cl"
MAIL_FROM_NAME="Sistema Leykarin"

NOTIFICATION_MAIL_FROM_ADDRESS=noreply@imaarica.cl
NOTIFICATION_MAIL_FROM_NAME="Sistema de denuncias Leykarin"

# ========================================
# CLAVE ÚNICA
# ========================================
CLAVEUNICA_CLIENT_ID=   # <--- Client ID de producción
CLAVEUNICA_CLIENT_SECRET=   # <--- Client Secret de producción
CLAVEUNICA_REDIRECT_URI=https://leykarin2.imaarica.cl/api/v1/auth/claveunica/callback

# ========================================
# GOOGLE OAUTH - PRODUCCIÓN
# ========================================
GOOGLE_CLIENT_ID=your-production-client-id.apps.googleusercontent.com
GOOGLE_CLIENT_SECRET=   # <--- Secret de producción
GOOGLE_ALLOWED_DOMAIN=imaarica.cl   # Dominio corporativo
GOOGLE_OAUTH_ENABLED=true
GOOGLE_OAUTH_AUTO_REGISTER=false   # Solo usuarios pre-registrados

# ========================================
# GOOGLE RECAPTCHA v3 - PRODUCCIÓN
# ========================================
RECAPTCHA_SITE_KEY=   # <--- Site key de producción
RECAPTCHA_SECRET_KEY=   # <--- Secret key de producción
RECAPTCHA_ENABLED=true
RECAPTCHA_MIN_SCORE=0.5
RECAPTCHA_TIMEOUT=10

# ========================================
# RATE LIMITING - PRODUCCIÓN (MÁS ESTRICTO)
# ========================================
RATE_LIMIT_LOGIN=5,1   # 5 intentos por minuto
RATE_LIMIT_RESET_PASSWORD=3,1   # 3 intentos por minuto
RATE_LIMIT_LOGOUT=10,1
RATE_LIMIT_API=60,1
RATE_LIMIT_COMPLAINT_SUBMISSION=3,60   # 3 denuncias por hora
RATE_LIMIT_PDF_DOWNLOAD=10,1
RATE_LIMIT_RESEND_RECEIPT=2,1   # 2 reenvíos por minuto

# ========================================
# LOGGING DE SEGURIDAD
# ========================================
SECURITY_LOG_CHANNEL=security
SECURITY_LOG_LEVEL=warning
SECURITY_MONITORING_ENABLED=true
SECURITY_ALERT_EMAIL=seguridad@imaarica.cl

FILE_UPLOAD_LOG_CHANNEL=file_uploads
FILE_UPLOAD_LOG_LEVEL=info

AUDIT_LOG_ENABLED=true
AUDIT_LOG_RETENTION_DAYS=365   # 1 año en producción

# ========================================
# VALIDACIÓN DE ARCHIVOS
# ========================================
MAX_FILE_SIZE_PDF=20480   # 20MB
MAX_FILE_SIZE_IMAGE=5120   # 5MB
MAX_FILE_SIZE_DOCUMENT=10240   # 10MB

ALLOWED_FILE_EXTENSIONS_PDF=pdf
ALLOWED_FILE_EXTENSIONS_IMAGE=jpg,jpeg,png,gif
ALLOWED_FILE_EXTENSIONS_DOCUMENT=doc,docx,pdf

MAX_TEMPORARY_FILES_PER_SESSION=10
MAX_TEMPORARY_FILES_TOTAL_SIZE=52428800   # 50MB

# ========================================
# STORAGE - PRODUCCIÓN
# ========================================
FILESYSTEM_DISK_PUBLIC=public
FILESYSTEM_DISK_PRIVATE=local

STORAGE_PATH_DECRETOS=decretos
STORAGE_PATH_VERIFICATIONS=verifications
STORAGE_PATH_TEMPLATES=templates

# ========================================
# QUEUES - PRODUCCIÓN
# ========================================
QUEUE_MAIL_CONNECTION=redis
QUEUE_MAIL_TABLE=jobs

# ========================================
# CACHE - PRODUCCIÓN
# ========================================
CACHE_ROLES_TTL=3600   # 1 hora
CACHE_PERMISSIONS_TTL=3600   # 1 hora

# ========================================
# FRONTEND URL
# ========================================
FRONTEND_URL=https://leykarin2.imaarica.cl

# ========================================
# DESARROLLO Y DEBUGGING (DESHABILITADO)
# ========================================
DEVELOPMENT_MODE=false
DEBUG_BAR_ENABLED=false
TESTING_MODE=false
MOCK_EXTERNAL_SERVICES=false

# ========================================
# SWAGGER/API DOCS (DESHABILITADO EN PROD)
# ========================================
L5_SWAGGER_GENERATE_ALWAYS=false
L5_SWAGGER_UI_DOC_EXPANSION=list
L5_SWAGGER_UI_OPERATIONS_SORTER=alpha

# ========================================
# MONITOREO Y ALERTAS
# ========================================
SENTRY_LARAVEL_DSN=   # <--- DSN de Sentry (opcional)
SENTRY_TRACES_SAMPLE_RATE=0.1

# ========================================
# BACKUP (OPCIONAL)
# ========================================
BACKUP_ENABLED=true
BACKUP_DISK=s3   # O el disco que uses
BACKUP_RETENTION_DAYS=30

# ========================================
# SSL/TLS
# ========================================
# Forzar HTTPS en toda la aplicación
FORCE_HTTPS=true

# ========================================
# NUEVAS CONFIGURACIONES DE SEGURIDAD
# ========================================
# Agregadas según análisis de seguridad del 04/10/2025

# Timeout de inactividad (30 minutos = 1800 segundos)
SESSION_INACTIVITY_TIMEOUT=1800

# Sesiones concurrentes
SESSION_MAX_CONCURRENT=3   # Máximo 3 sesiones por usuario
SESSION_CONCURRENT_STRATEGY=notify   # notify|block|logout_oldest

# Encriptación de sesiones
SESSION_ENCRYPT=true

# ========================================
# VALIDACIÓN DE IP Y ALERTAS (10/10)
# ========================================
# Configuraciones adicionales para seguridad máxima

# IPs confiables (proxies, VPN corporativa) - separadas por comas
TRUSTED_IPS=

# Permitir cambio de IP en la misma subred /24
ALLOW_SAME_SUBNET=true

# Emails para alertas de seguridad (separados por comas)
SECURITY_ALERT_EMAILS=seguridad@imaarica.cl,admin@imaarica.cl

# Webhook de Slack para alertas (opcional)
SECURITY_SLACK_WEBHOOK=

# Auditoría de seguridad automatizada
SECURITY_AUDIT_ENABLED=true

# ========================================
# NOTAS DE SEGURIDAD
# ========================================
# 1. NUNCA commitear este archivo con valores reales
# 2. Usar contraseñas de 32+ caracteres generadas aleatoriamente
# 3. Rotar credenciales cada 90 días
# 4. Habilitar 2FA para todos los usuarios administrativos
# 5. Monitorear logs de seguridad diariamente
# 6. Realizar backups automáticos diarios
# 7. Mantener Laravel y dependencias actualizadas
# 8. Ejecutar php artisan config:cache después de cambios
# 9. Verificar permisos de archivos (storage/ debe ser 755)
# 10. Usar HTTPS SIEMPRE - No permitir HTTP en producción

# ========================================
# VARIABLES ELIMINADAS (NO SE USAN)
# ========================================
# Las siguientes variables fueron eliminadas porque no se usan en el proyecto:
# - AWS_* (no se usa S3, solo almacenamiento local)
# - PUSHER_* (no se usa broadcasting/websockets)
# - MEMCACHED_* (no se usa Memcached, solo Redis/File)
# - VITE_* (frontend es Angular, no Vite)
#
# Si necesitas alguna de estas funcionalidades en el futuro, consulta
# la documentación de Laravel para agregarlas correctamente.
